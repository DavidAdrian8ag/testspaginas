<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Â¿Sabes de mi?</title>

<script src="https://public.codepenassets.com/js/prefixfree-1.0.7.min.js"></script>

<style>
@import url("https://fonts.googleapis.com/css2?family=Homemade+Apple&family=Rock+Salt&display=swap");

:root { --scroll: 0; }

body {
   margin: 0;
   overflow: hidden; /* <-- CAMBIO: evita scroll global */
   background-color: #444;
   display: flex;
   justify-content: center;
   align-items: center;
   height: 100vh;
}

.safe-scroll {        /* <-- CAMBIO: contenedor interno que hace scroll */
   width: 100%;
   height: 100%;
   overflow-y: scroll;
}

.r {
   min-height: 10000px;
}

.safe {
   top: 0;
   bottom: 0;
   width: 100vw;
   height: 100vh;
   display: flex;
   flex-direction: column;
   align-items: center;
   justify-content: center;
   background-color: #444;
}

.safe h1 {
   font-family: "Rock Salt";
   color: white;
}

.safe p {
   font-size: 0.9em;
   line-height: 1.5em;
   font-family: "Rock Salt";
   max-width: 250px;
   text-align: justify;
   color: white;
}

.box {
   width: 250px;
   height: 250px;
   display: flex;
   align-items: center;
   justify-content: center;
   transform: rotate(calc(var(--scroll) * 0.08deg));
   transform-origin: center;
}

/* resto de tu CSS igual... */
.innerdial {
   position: absolute;
   top: 0;
   left: 0;
   width: 250px;
   height: 250px;
   z-index: 2;
   background-color: silver;
   border: 1px solid black;
   border-radius: 50%;
}

.mark {
   position: absolute;
   top: 122px;
   left: 115px;
   width: 20px;
   height: 6px;
   background-color: grey;
   border: 1px solid black;
   transform-origin: 10px 3px;
}

.center {
   position: absolute;
   top: 50px;
   left: 50px;
   width: 150px;
   height: 150px;
   border-radius: 50%;
   background-color: grey;
   border: 1px solid black;
}

.start {
   position: absolute;
   top: 70px;
   left: 65px;
   width: 20px;
   height: 10px;
   background-color: white;
   transform: rotate(-90deg) translateX(60px);
}

.position {
   position: relative;
   margin-top: 5px;
   text-align: center;
   padding: 3px;
   min-width: 24px;
   border: 1px solid black;
   background-color: #fff;
   font-family: monospace;
   color: #888;
}

.box-flash {
   position: absolute;
   top: 0;
   left: 0;
   width: 250px;
   height: 250px;
   background-color: silver;
   border-radius: 50%;
   opacity: 0.9;
   z-index: -1;
}

.click { animation: click 0.2s 1; }
.near { animation: near 0.2s 1; }
.off { animation: off 0.2s 1; }

/* animaciones igual... */

.chalkboard {
   position: absolute;
   left: 15vw;
   top: 50vh;
   padding: 20px;
   font-size: 4em;
   font-family: "Homemade Apple";
   transform: rotate(15deg);
   color: #fff;
   white-space: pre;
   line-height: 1em;
}

.hint {
   position: absolute;
   right: 20px;
   bottom: 20px;
   padding: 20px;
   font-family: "Homemade Apple";
   transform: rotate(-15deg);
   white-space: pre;
   line-height: 1em;
   color: #393939;
}

/* FINAL SCREEN CSS igual... */

</style>
</head>

<body>

<!-- CONTENEDOR SCROLLABLE -->
<div class="safe-scroll"> <!-- <-- CAMBIO -->
<main>
   <div class="r">
      <div class="safe">
         <h1>Resuelve el cÃ³digo</h1>

         <div class="box">
            <div class="innerdial"></div>
            <div class="box-flash"></div>
         </div>

         <div class="position">0</div>

         <p>Gira para encontrar la combinaciÃ³n. Detente en el nÃºmero correcto.</p>
         <p>Â¿QuÃ© tanto sabes de mi?</p>
         <p>Calzo del ...</p>
         <p>Â¿Mi aÃ±o nacimiento?</p>
         <p>AÃ±o que Bluchino fue adoptado</p>
         <p>Modelo de mi iphone</p>
         <p>AÃ±o que viajÃ³ marty al futuro</p>

         <div class="chalkboard"></div>
         <div class="hint"></div>
      </div>
   </div>
</main>
</div>

<!-- FINAL -->
<div class="celebration" id="celebration">
   <h1>ðŸŒˆ Â¡Has llegado al final del arcoÃ­ris! <br> y a darle color a mi vida ðŸŒˆ</h1>
   <button class="rainbow-button" onclick="window.location.href='papeles.html'">Â¡Sigamos!</button>
</div>

<script>
// marcas
const innerDial = document.querySelector(".innerdial");
for (let i = 0; i < 16; i++) {
   const mark = document.createElement("div");
   mark.classList.add("mark");
   mark.style.transform = `rotate(${i * 22.5}deg) translateX(100px)`;
   innerDial.appendChild(mark);
}
innerDial.innerHTML += '<div class="center"><div class="start"></div></div>';

const combination = [7, 84, 20, 11, 15];

const scrollBox = document.querySelector(".safe-scroll"); /* <-- CAMBIO */

const pageHeight = window.innerHeight;

let pos = 0, pSafePost = 0, cracked = false, win = false, timer;

const root = document.documentElement;
const position = document.querySelector(".position");
const chalkboard = document.querySelector(".chalkboard");
const boxFlash = document.querySelector(".box-flash");
const celebration = document.getElementById("celebration");

function createConfetti() {
   const confetti = document.createElement("div");
   confetti.classList.add("confetti");
   confetti.style.left = Math.random() * 100 + "vw";
   confetti.style.setProperty("--hue", Math.random() * 360);
   confetti.style.animationDuration = 2 + Math.random() * 3 + "s";
   celebration.appendChild(confetti);
   setTimeout(() => confetti.remove(), 5000);
}

function startInfiniteConfetti() {
   setInterval(() => {
      for (let i = 0; i < 8; i++) createConfetti();
   }, 300);
}

/* <-- CAMBIO TOTAL: listener de scroll en el contenedor, no en window */
scrollBox.addEventListener("scroll", () => {
   root.style.setProperty("--scroll", scrollBox.scrollTop);

   const safePos = Math.floor(scrollBox.scrollTop / (10000 - pageHeight) * 100);
   position.innerText = safePos;

   if (timer) clearTimeout(timer);

   timer = setTimeout(() => {
      if (safePos === pSafePost) return;

      boxFlash.classList.remove("click", "near", "off");

      if (safePos && combination[pos] === safePos) {
         void boxFlash.offsetWidth;
         boxFlash.classList.add("click");
         chalkboard.innerText += safePos + "\n";
         if (++pos === combination.length) cracked = true;

      } else if (safePos && Math.abs(combination[pos] - safePos) < 3) {
         void boxFlash.offsetWidth;
         boxFlash.classList.add("near");

      } else {
         void boxFlash.offsetWidth;
         boxFlash.classList.add("off");
      }

      pSafePost = safePos;
   }, 100);

   if (cracked && !win) {
      win = true;
      setTimeout(() => {
         celebration.style.display = "flex";
         startInfiniteConfetti();
      }, 800);
   }
});
</script>

</body>
</html>
